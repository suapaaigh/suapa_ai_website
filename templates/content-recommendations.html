{% extends "layout.html" %}
{% load static %}
{% block title %}Content Recommendations - Sua Pa AI{% endblock %}

{% block content %}
<main>
    <!-- breadcrumb area start -->
    {% include "breadcrumb.html" %}
    <!-- breadcrumb area end -->

    <!-- content recommendations area start -->
    <section class="content-recommendations-area pt-140 pb-60">
        <div class="container">
            <div class="row">
                <div class="col-xl-10 col-lg-10 mx-auto">
                    <div class="recommendations-content">
                        <div class="text-center mb-50">
                            <span class="recommendations-subtitle">Personalized for You</span>
                            <h2 class="recommendations-title">Your Learning Recommendations</h2>
                            <p class="recommendations-description">
                                Based on your profile, we've curated content that matches your learning style and goals.
                                Select the subjects that interest you most to get started!
                            </p>
                        </div>

                        {% if messages %}
                            {% for message in messages %}
                                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                            {% endfor %}
                        {% endif %}

                        <!-- Learning Profile Summary -->
                        <div class="profile-summary mb-40">
                            <h3 class="section-title">Your Learning Profile</h3>
                            <div class="profile-tags">
                                <span class="profile-tag education-level">{{ learning_summary.education_level }}</span>
                                {% if learning_summary.grade_level %}
                                    <span class="profile-tag grade">Grade {{ learning_summary.grade_level }}</span>
                                {% endif %}
                                <span class="profile-tag learning-style">{{ learning_summary.learning_style }}</span>
                                <span class="profile-tag difficulty">{{ learning_summary.difficulty_preference }}</span>
                                <span class="profile-tag motivation">{{ learning_summary.motivation_type }}</span>
                            </div>
                        </div>

                        <form method="POST" class="recommendations-form">
                            {% csrf_token %}

                            <!-- Recommended Subjects -->
                            <div class="recommendations-section">
                                <h3 class="section-title">Recommended Subjects for You</h3>
                                <p class="section-description">Choose the subjects you'd like to explore first:</p>

                                <div class="subjects-grid">
                                    {% for subject in recommended_subjects %}
                                    <div class="subject-recommendation-card">
                                        <div class="subject-card-header">
                                            <h4>{{ subject.name }}</h4>
                                            <span class="subject-level">{{ subject.get_education_level_display }}</span>
                                        </div>
                                        <p class="subject-description">{{ subject.description|truncatechars:120 }}</p>

                                        {% if subject.topics %}
                                        <div class="subject-topics">
                                            <strong>What you'll learn:</strong>
                                            <div class="topics-list">
                                                {% for topic in subject.topics|slice:":4" %}
                                                    <span class="topic-tag">{{ topic }}</span>
                                                {% endfor %}
                                                {% if subject.topics|length > 4 %}
                                                    <span class="topic-tag more">+{{ subject.topics|length|add:"-4" }} more</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                        {% endif %}

                                        <div class="subject-selection">
                                            <label class="subject-checkbox">
                                                <input type="checkbox" name="selected_subjects" value="{{ subject.id }}">
                                                <span class="checkmark"></span>
                                                <span class="checkbox-label">I want to learn this</span>
                                            </label>
                                        </div>

                                        {% if subject in education_profile.favorite_subjects.all %}
                                        <div class="already-favorite">
                                            <i class="fa-solid fa-heart"></i>
                                            <span>Already in your favorites</span>
                                        </div>
                                        {% endif %}
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>

                            <!-- Daily Recommendations -->
                            {% if daily_recommendations %}
                            <div class="recommendations-section">
                                <h3 class="section-title">Today's Content Recommendations</h3>
                                <p class="section-description">Content curated specifically for your learning preferences:</p>

                                <div class="daily-recommendations">
                                    {% for recommendation in daily_recommendations %}
                                    <div class="recommendation-item">
                                        <div class="recommendation-header">
                                            <div class="content-info">
                                                <h5>{{ recommendation.content.title }}</h5>
                                                <span class="content-subject">{{ recommendation.subject.name }}</span>
                                                <span class="content-type">{{ recommendation.content.get_content_type_display }}</span>
                                            </div>
                                            <div class="content-meta">
                                                <span class="difficulty-badge difficulty-{{ recommendation.content.difficulty_level }}">
                                                    {{ recommendation.content.get_difficulty_level_display }}
                                                </span>
                                            </div>
                                        </div>
                                        <p class="content-description">{{ recommendation.content.description|truncatechars:150 }}</p>
                                        <div class="recommendation-footer">
                                            <span class="recommendation-reason">
                                                <i class="fa-light fa-lightbulb"></i>
                                                {{ recommendation.reason }}
                                            </span>
                                            {% if recommendation.content.estimated_duration %}
                                            <span class="content-duration">
                                                <i class="fa-light fa-clock"></i>
                                                {{ recommendation.content.estimated_duration }} min
                                            </span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}

                            <!-- Learning Paths Preview -->
                            {% if learning_paths %}
                            <div class="recommendations-section">
                                <h3 class="section-title">Your Learning Paths</h3>
                                <p class="section-description">Structured learning journeys for your top subjects:</p>

                                <div class="learning-paths">
                                    {% for path in learning_paths %}
                                    <div class="learning-path-card">
                                        <div class="path-header">
                                            <h4>{{ path.subject.name }}</h4>
                                            <div class="path-progress">
                                                <span>{{ path.completed_count }}/{{ path.total_content }} completed</span>
                                                <div class="progress-bar">
                                                    <div class="progress-fill" style="width: {% widthratio path.completed_count path.total_content 100 %}%"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="path-content-groups">
                                            {% for group in path.content_groups %}
                                            <div class="content-group">
                                                <h6>{{ group.difficulty|title }} Level</h6>
                                                <div class="content-items">
                                                    {% for item in group.content_items|slice:":3" %}
                                                    <span class="content-item status-{{ item.status }}">
                                                        {% if item.status == 'completed' or item.status == 'mastered' %}
                                                            <i class="fa-solid fa-check"></i>
                                                        {% elif item.status == 'in_progress' %}
                                                            <i class="fa-solid fa-play"></i>
                                                        {% else %}
                                                            <i class="fa-regular fa-circle"></i>
                                                        {% endif %}
                                                        {{ item.content.title|truncatechars:30 }}
                                                    </span>
                                                    {% endfor %}
                                                    {% if group.content_items|length > 3 %}
                                                    <span class="content-item more">+{{ group.content_items|length|add:"-3" }} more</span>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}

                            <!-- Action Buttons -->
                            <div class="recommendations-actions">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fa-light fa-rocket"></i>
                                    Start My Learning Journey
                                </button>
                                <a href="{% url 'my-bot' %}" class="btn btn-secondary btn-lg">
                                    <i class="fa-light fa-arrow-right"></i>
                                    Skip to AI Tutor
                                </a>
                            </div>

                            <div class="recommendations-note">
                                <p><i class="fa-light fa-info-circle"></i>
                                Don't worry! You can always change your preferences later in your profile settings.</p>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- content recommendations area end -->
</main>

<style>
.recommendations-content {
    background: #fff;
    padding: 50px;
    border-radius: 20px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.1);
}

.recommendations-subtitle {
    color: #6366f1;
    font-size: 16px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.recommendations-title {
    color: #1f2937;
    margin-bottom: 15px;
    font-size: 36px;
    font-weight: 700;
}

.recommendations-description {
    color: #6b7280;
    font-size: 18px;
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
}

.profile-summary {
    background: linear-gradient(135deg, #f8fafc, #e2e8f0);
    padding: 25px;
    border-radius: 15px;
    border-left: 5px solid #6366f1;
}

.profile-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-top: 15px;
}

.profile-tag {
    background: #6366f1;
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 500;
}

.profile-tag.education-level { background: #059669; }
.profile-tag.grade { background: #dc2626; }
.profile-tag.learning-style { background: #7c3aed; }
.profile-tag.difficulty { background: #ea580c; }
.profile-tag.motivation { background: #0891b2; }

.recommendations-section {
    margin-bottom: 50px;
    padding-bottom: 40px;
    border-bottom: 1px solid #e5e7eb;
}

.recommendations-section:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.section-title {
    color: #374151;
    margin-bottom: 15px;
    font-size: 28px;
    font-weight: 600;
}

.section-description {
    color: #6b7280;
    margin-bottom: 30px;
    font-size: 16px;
    line-height: 1.6;
}

.subjects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 25px;
}

.subject-recommendation-card {
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: 15px;
    padding: 25px;
    transition: all 0.3s ease;
    position: relative;
}

.subject-recommendation-card:hover {
    border-color: #6366f1;
    box-shadow: 0 8px 25px rgba(99, 102, 241, 0.15);
    transform: translateY(-2px);
}

.subject-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.subject-card-header h4 {
    color: #1f2937;
    margin: 0;
    font-size: 20px;
    font-weight: 600;
}

.subject-level {
    background: #6366f1;
    color: white;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
}

.subject-description {
    color: #6b7280;
    margin-bottom: 20px;
    line-height: 1.5;
}

.subject-topics {
    margin-bottom: 20px;
}

.topics-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
}

.topic-tag {
    background: #e0e7ff;
    color: #3730a3;
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 12px;
    font-weight: 500;
}

.topic-tag.more {
    background: #f3f4f6;
    color: #6b7280;
}

.subject-selection {
    margin-top: 20px;
}

.subject-checkbox {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-weight: 500;
    color: #374151;
}

.subject-checkbox input[type="checkbox"] {
    width: 18px;
    height: 18px;
    margin-right: 12px;
    accent-color: #6366f1;
}

.already-favorite {
    position: absolute;
    top: 15px;
    right: 15px;
    background: #fee2e2;
    color: #dc2626;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
}

.already-favorite i {
    margin-right: 5px;
}

.daily-recommendations {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.recommendation-item {
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 20px;
    transition: all 0.3s ease;
}

.recommendation-item:hover {
    border-color: #6366f1;
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.1);
}

.recommendation-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
}

.content-info h5 {
    color: #1f2937;
    margin: 0 0 8px 0;
    font-size: 18px;
    font-weight: 600;
}

.content-subject {
    background: #6366f1;
    color: white;
    padding: 3px 8px;
    border-radius: 6px;
    font-size: 11px;
    margin-right: 8px;
}

.content-type {
    background: #f3f4f6;
    color: #6b7280;
    padding: 3px 8px;
    border-radius: 6px;
    font-size: 11px;
}

.difficulty-badge {
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 12px;
    font-weight: 600;
}

.difficulty-beginner { background: #dcfce7; color: #166534; }
.difficulty-intermediate { background: #fef3c7; color: #92400e; }
.difficulty-advanced { background: #fee2e2; color: #991b1b; }

.content-description {
    color: #6b7280;
    margin-bottom: 15px;
    line-height: 1.5;
}

.recommendation-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
}

.recommendation-reason {
    color: #6366f1;
    font-weight: 500;
}

.recommendation-reason i {
    margin-right: 6px;
}

.content-duration {
    color: #6b7280;
}

.content-duration i {
    margin-right: 6px;
}

.learning-paths {
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.learning-path-card {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 15px;
    padding: 25px;
}

.path-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.path-header h4 {
    color: #1f2937;
    margin: 0;
    font-size: 20px;
    font-weight: 600;
}

.path-progress {
    text-align: right;
}

.path-progress span {
    color: #6b7280;
    font-size: 14px;
    margin-bottom: 8px;
    display: block;
}

.progress-bar {
    width: 150px;
    height: 8px;
    background: #e5e7eb;
    border-radius: 4px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #6366f1, #8b5cf6);
    transition: width 0.3s ease;
}

.content-group {
    margin-bottom: 15px;
}

.content-group h6 {
    color: #374151;
    margin-bottom: 10px;
    font-size: 14px;
    font-weight: 600;
}

.content-items {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.content-item {
    background: #ffffff;
    border: 1px solid #d1d5db;
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
}

.content-item.status-completed,
.content-item.status-mastered {
    background: #dcfce7;
    border-color: #16a34a;
    color: #166534;
}

.content-item.status-in_progress {
    background: #fef3c7;
    border-color: #f59e0b;
    color: #92400e;
}

.content-item.more {
    background: #f3f4f6;
    color: #6b7280;
}

.recommendations-actions {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 40px 0 20px 0;
}

.btn {
    padding: 15px 30px;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    text-decoration: none;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 10px;
}

.btn-primary {
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
    color: white;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
}

.btn-secondary {
    background: #f3f4f6;
    color: #374151;
    border: 1px solid #d1d5db;
}

.btn-secondary:hover {
    background: #e5e7eb;
    color: #1f2937;
}

.recommendations-note {
    text-align: center;
    color: #6b7280;
    font-style: italic;
}

@media (max-width: 768px) {
    .recommendations-content {
        padding: 30px 20px;
    }

    .subjects-grid {
        grid-template-columns: 1fr;
    }

    .recommendation-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }

    .path-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }

    .recommendations-actions {
        flex-direction: column;
        align-items: center;
    }

    .btn {
        width: 100%;
        justify-content: center;
    }
}
</style>
{% endblock %}